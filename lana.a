	
	;ALDAGAIAK DEFINITU 

	; Aldagaiak
	EGOERA EQU 20H
	GERTAERA EQU 21H
	TENPERATURA EQU 22H
		
	;Sentsoreak
	ATE_SNTS EQU P1.1
	BETE_SNTS EQU P1.2
	HUSTU_SNTS EQU P1.3
	
	;Motoreak
	HUSTU_MTR EQU P1.0
	BETE_MTR EQU P3.3
	BEROG EQU P3.6
		
	;Gainkarga (ADC0)
;	GAINK EQU ADC0	;P5.0	LIBRERIA????????????????????????????????????????????????????????
		
	HASI_BTN EQU P3.2
		
	;Hamarrekoen Displaya
	D1_A EQU P0.0
	D1_B EQU P0.1
	D1_C EQU P0.2
	D1_D EQU P0.3
	D1_E EQU P0.4
	D1_F EQU P0.5
	D1_G EQU P0.6
	
	;Unitateen displaya
	D2_A EQU P2.0
	D2_B EQU P2.1
	D2_C EQU P2.2
	D2_D EQU P2.3
	D2_E EQU P2.4
	D2_F EQU P2.5
	D2_G EQU P2.6

ORG 00H
	
	AJMP HASIERAKETAK
	
ORG 0BH
;	LCALL TIMER_0
	RETI

ORG 1BH
;	LCALL TIMER_1
	RETI


	HASIERAKETAK:
	MOV EGOERA,00H
	MOV GERTAERA,00H
	MOV TENPERATURA,00H
		
	;Motoreak
	CLR HUSTU_MTR
	CLR BETE_MTR
	CLR BEROG
		
	;Hamarrekoen Displaya
	CLR D1_A
	CLR D1_B
	CLR D1_C
	CLR D1_D
	CLR D1_E
	CLR D1_F
	CLR D1_G
	
	;Unitateen displaya
	CLR D2_A
	CLR D2_B
	CLR D2_C
	CLR D2_D
	CLR D2_E
	CLR D2_F
	CLR D2_G


	;IDLE:
	SETB IE.0
	SETB 98H
	MOV 87H,#01H    
	ORG 0x03
	CLR EA
	CALL INT0ETENA
	

	INT0ETENA:
	CLR IE.0
	MOV A,#01H
	RET

	JB HASI_BTN,HASIERAKETAK

	ITXARON:
		SETB IE.0
		;SETB PCON.0	********************************************************
		CLR IE.0

	EGOERA_MAKINA:
		MOV A, EGOERA
		RL A
		MOV DPTR, #EGOERA_TAULA
		JMP @A+DPTR
	
	EGOERA_TAULA:
		AJMP EGOERA_0	; Atea konprobatu
		AJMP EGOERA_1	; Pisua konprobatu
		AJMP EGOERA_2	; Betetzen
		AJMP EGOERA_3	; Berotzen
		AJMP EGOERA_4	; Garbitzen
		AJMP EGOERA_5	; Husten
		AJMP EGOERA_6	; Zentrifugatzen
		AJMP EGOERA_7	; Amaiera
		
		
	EGOERA_0:
		ACALL GERTAERA_SORGAILUA_0
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_0
		JMP @A+DPTR
		
		EKINTZA_TAULA_0:
;		AJMP DISPLAYAK_EGUNERATU_PA
;		AJMP ATEA_ITXI
		AJMP AMAIERA
	
	GERTAERA_SORGAILUA_0:
		JB ATE_SNTS, ATE_IREKIA_0
		MOV GERTAERA, 01H	; atea itxita
		MOV B, 00H
		SJMP GZ_0_AM

		ATE_IREKIA_0:
;		JNB B, LEHENENGO_ALDIA		************ERROR----->DATA-ADDRESS EXPECTED????????????????????????????????????????
		MOV GERTAERA,03H	; aurreko bueltan atea jada irekita zegoen
		SJMP GZ_0_AM
		LEHENENGO_ALDIA:
		MOV GERTAERA, 00H	; atea irekita
		MOV B, 01H
		GZ_0_AM:
		RET
		
		
	EGOERA_1:
		ACALL GERTAERA_SORGAILUA_1
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_1
		JMP @A+DPTR
		
	EKINTZA_TAULA_1:
;		JMP DISPLAYAK_EGUNERATU_SP
;		JMP ATEA_IREKI
;		JMP BETE
		
	GERTAERA_SORGAILUA_1:
		JB ATE_SNTS, ATE_IREKIA_1
		; ADC KONPROBATU!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
		; JARRI BESTE GERTAERA ERREPIKATZEN DENERAKO
		SJMP GZ_1_AM
		ATE_IREKIA_1:
		MOV GERTAERA,01H
		GZ_1_AM:
		RET
				
	EGOERA_2:
		ACALL GERTAERA_SORGAILUA_2
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_2
		JMP @A+DPTR
		
	EKINTZA_TAULA_2:
		AJMP AMAIERA
		AJMP BETETA
		
	GERTAERA_SORGAILUA_2:
		JB BETE_SNTS, BETETA
		MOV GERTAERA, 00H	; oraindik ez da bete
		SJMP GZ_2_AM
		BETETA:
		MOV GERTAERA, 02H	; guztiz beteta
		GZ_2_AM:
		RET

	EGOERA_3:
		ACALL GERTAERA_SORGAILUA_3
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_3
		JMP @A+DPTR
		
	EKINTZA_TAULA_3:
		
	GERTAERA_SORGAILUA_3:
;		ACALL TENPERATURA_ZEHAZTU
		;TENPERATURA IRAKURRI ETA KONPARATU HAUTATUTAKOAREKIN!!!!!!!!!!!!	
		RET
				
	EGOERA_4:
		ACALL GERTAERA_SORGAILUA_4
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_4
		JMP @A+DPTR
	
	EKINTZA_TAULA_4:

	GERTAERA_SORGAILUA_4:
		;TIMER ENABLE????????????????????????????
		RET

	EGOERA_5:
		ACALL GERTAERA_SORGAILUA_5
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_5
		JMP @A+DPTR
	
	EKINTZA_TAULA_5:
	
	GERTAERA_SORGAILUA_5:
		JB BETE_SNTS, HUTSIK
		MOV GERTAERA, 00H
		SJMP GZ_5_AM
		HUTSIK:
		MOV GERTAERA, 01H
		GZ_5_AM:
		RET
	
	EGOERA_6:
		ACALL GERTAERA_SORGAILUA_6
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_6
		JMP @A+DPTR
		
	EKINTZA_TAULA_6:

	GERTAERA_SORGAILUA_6:
		;TIMER ENABLE??????????????????????
		RET	
	
	EGOERA_7:
		ACALL GERTAERA_SORGAILUA_7
		MOV A, GERTAERA
		RL A
		MOV DPTR, #EKINTZA_TAULA_7
		JMP @A+DPTR	
		
	EKINTZA_TAULA_7:

	GERTAERA_SORGAILUA_7:
		JB ATE_SNTS, ATE_IREKIA_7
		MOV GERTAERA, 01H
		SJMP GZ_7_AM
		ATE_IREKIA_7:
		MOV GERTAERA,00H
		GZ_7_AM:
		RET
		
	
	ATEA_IXI:

	ATEA_IREKI:

	DISPLAYAK_EGUNERATU_PA:

	DISPLAYAK_EGUNERATU_SP:

	DISPLAYAK_EGUERATU_FF:
	
	DISPLAYAK_EGUNERATU_DENBORA:
	
	

	AMAIERA:
		LJMP EGOERA_MAKINA
	
	
	END